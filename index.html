<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title> URBAN TECH - Tienda Oficial </title>
<style>
  /* ... tu CSS igual, no lo cambio aquí para no hacer muy largo el mensaje ... */
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: #f5f5f5;
    color: #333;
    display: flex;
    flex-direction: column;
    min-height: 100vh;
  }
  
  /* Header */
  header {
    background: linear-gradient(135deg, #f53629, #000000);
    color: white;
    padding: 1rem;
    position: sticky;
    top: 0;
    z-index: 999;
    box-shadow: 0 2px 10px rgba(0,0,0,0.2);
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  
  .logo {
    height: 40px;
  }
  .logo-title {
  display: flex;
  align-items: center;
  gap: 1rem;
}

.site-title {
  font-size: 1.8rem;
  font-weight: bold;
  color: white;
  margin: 0;
}

  .header-right {
    display: flex;
    align-items: center;
    gap: 1rem;
  }
  
  .cart-btn {
    background: #e6a904;
    border: none;
    color: white;
    padding: 0.5rem 1rem;
    border-radius: 5px;
    cursor: pointer;
    font-weight: bold;
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }
  
  .cart-count {
    background: #e91e63;
    border-radius: 50%;
    width: 24px;
    height: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.8rem;
  }
  
  /* Navigation - Categorías alineadas a la derecha */
 nav {
    background: linear-gradient(135deg, #000000, #f53629);
    color: white;
    padding: 1rem;
    position: sticky;
    top: 0;
    z-index: 1000;
    box-shadow: 0 2px 10px rgba(0,0,0,0.2);
    display: flex;
    justify-content: space-between;
    align-items: center;/* Cambiado de flex-end a flex-start */
  }
  
  .categories-menu {
    display: flex;
    list-style: none;
    gap: 1.5rem;
    overflow-x: auto;
    padding: 0.5rem 0;
    margin-right: 20px;
  }
  
  .categories-menu li {
    position: relative;
  }
  
  .categories-menu a {
    color: white;
    text-decoration: none;
    font-weight: 500;
    padding: 0.5rem 0;
    white-space: nowrap;
  }
  
  .subcategories {
    position: static; /* cambiado de absolute */
    background: #fa786e;
    border-radius: 0 0 5px 5px;
    display: none; /* ocultas por defecto */
    padding-left: 1rem;
    margin-top: 0.5rem;
    list-style: none;
  }
  
  .categories-menu li:hover .subcategories {
    display: block;
  }
  
  .subcategories a {
    color: #333;
    display: block;
    padding: 0.7rem 1rem;
    border-bottom: 1px solid #eee;
  }
  
  .subcategories a:hover {
    background: #f5f5f5;
  }
  
  /* Main Content */
  .main-container {
    display: flex;
    flex: 1;
  }
  
  /* Sidebar */
  .sidebar {
    width: 250px;
    background: white;
    padding: 1rem;
    border-right: 1px solid #ddd;
    display: none;
  }
  
  .banner {
    margin-bottom: 1rem;
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
  }
  
  .banner img {
    width: 100%;
    display: block;
  }
  
  .floating-banner {
    animation: float 3s ease-in-out infinite;
  }
  
  @keyframes float {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-10px); }
  }
  
  /* Product Grid */
  .content {
    flex: 1;
    padding: 1.5rem;
  }
  
  .products-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
    gap: 1.5rem;
  }
  
  .product-card {
    background: white;
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    transition: transform 0.3s, box-shadow 0.3s;
  }
  
  .product-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 5px 15px rgba(0,0,0,0.2);
  }
  
  .product-image {
    height: 200px;
    background: #f9f9f9;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 1rem;
  }
  
  .product-image img {
    max-width: 100%;
    max-height: 100%;
    object-fit: contain;
  }
  
  .product-info {
    padding: 1rem;
  }
  
  .product-title {
    font-size: 1rem;
    margin-bottom: 0.5rem;
    color: #333;
  }
  
  .product-price {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-bottom: 0.5rem;
  }
  
  .current-price {
    font-weight: bold;
    font-size: 1.2rem;
    color: #004aad;
  }
  
  .original-price {
    text-decoration: line-through;
    color: #999;
    font-size: 0.9rem;
  }
  
  .discount-badge {
    background: #e91e63;
    color: white;
    padding: 0.2rem 0.5rem;
    border-radius: 4px;
    font-size: 0.8rem;
    font-weight: bold;
  }
  
  .add-to-cart {
    width: 100%;
    background: #004aad;
    color: white;
    border: none;
    padding: 0.7rem;
    border-radius: 5px;
    cursor: pointer;
    font-weight: bold;
    margin-top: 0.5rem;
    transition: background 0.3s;
  }
  
  .add-to-cart:hover {
    background: #003580;
  }
  
  /* Shopping Cart */
  .cart-overlay {
    position: fixed;
    top: 0;
    right: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.5);
    z-index: 2000;
    display: none;
    justify-content: flex-end;
  }
  
  .cart-container {
    width: 100%;
    max-width: 400px;
    background: white;
    height: 100%;
    overflow-y: auto;
    padding: 1.5rem;
    box-shadow: -5px 0 15px rgba(0,0,0,0.2);
  }
  
  .cart-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1.5rem;
    padding-bottom: 1rem;
    border-bottom: 1px solid #eee;
  }
  
  .close-cart {
    background: none;
    border: none;
    font-size: 1.5rem;
    cursor: pointer;
    color: #666;
  }
  
  .cart-items {
    margin-bottom: 1.5rem;
  }
  
  .cart-item {
    display: flex;
    gap: 1rem;
    margin-bottom: 1rem;
    padding-bottom: 1rem;
    border-bottom: 1px solid #eee;
  }
  
  .cart-item-image {
    width: 80px;
    height: 80px;
    background: #f9f9f9;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  
  .cart-item-image img {
    max-width: 100%;
    max-height: 100%;
  }
  
  .cart-item-details {
    flex: 1;
  }
  
  .cart-item-title {
    font-weight: 500;
    margin-bottom: 0.3rem;
  }
  
  .cart-item-price {
    color: #004aad;
    font-weight: bold;
    margin-bottom: 0.5rem;
  }
  
  .cart-item-actions {
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }
  
  .quantity-btn {
    width: 25px;
    height: 25px;
    border: 1px solid #ddd;
    background: #f9f9f9;
    border-radius: 4px;
    cursor: pointer;
  }
  
  .remove-item {
    margin-left: auto;
    background: none;
    border: none;
    color: #e91e63;
    cursor: pointer;
  }
  
  .cart-summary {
    border-top: 1px solid #eee;
    padding-top: 1rem;
  }
  
  .cart-total {
    display: flex;
    justify-content: space-between;
    font-size: 1.2rem;
    font-weight: bold;
    margin-bottom: 1.5rem;
  }
  
  .cart-buttons {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }
  
  .checkout-btn, .clear-cart-btn {
    padding: 0.8rem;
    border: none;
    border-radius: 5px;
    font-weight: bold;
    cursor: pointer;
  }
  
  .checkout-btn {
    background: #004aad;
    color: white;
  }
  
  .clear-cart-btn {
    background: #f5f5f5;
    color: #333;
  }
  
  /* Modal de datos de envío */
  .modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.5);
    z-index: 3000;
    justify-content: center;
    align-items: center;
  }
  
  .modal-content {
    background: white;
    padding: 2rem;
    border-radius: 10px;
    width: 90%;
    max-width: 500px;
    box-shadow: 0 5px 20px rgba(0,0,0,0.2);
  }
  
  .modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1.5rem;
  }
  
  .close-modal {
    background: none;
    border: none;
    font-size: 1.5rem;
    cursor: pointer;
  }
  
  .form-group {
    margin-bottom: 1rem;
  }
  
  .form-group label {
    display: block;
    margin-bottom: 0.5rem;
    font-weight: 500;
  }
  
  .form-group input {
    width: 100%;
    padding: 0.8rem;
    border: 1px solid #ddd;
    border-radius: 5px;
    font-size: 1rem;
  }
  
  .submit-btn {
    background: #004aad;
    color: white;
    border: none;
    padding: 0.8rem 1.5rem;
    border-radius: 5px;
    font-weight: bold;
    cursor: pointer;
    width: 100%;
    margin-top: 1rem;
  }
  
  /* promociones color de la banda inferior */
  .promotions-bar {
     background: linear-gradient(135deg, #f53629, #000000);
    color: white;
    padding: 1rem;
    position: sticky;
    top: 0;
    z-index: 1000;
    box-shadow: 0 2px 10px rgba(0,0,0,0.2);
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  
  .promotions-content {
    display: inline-block;
    white-space: nowrap;
    padding-left: 100%;
    animation: marquee 20s linear infinite;
  }
  
  @keyframes marquee {
    0% { transform: translateX(0); }
    100% { transform: translateX(-100%); }
  }
  
  /* Responsive */
  @media (min-width: 992px) {
    .sidebar {
      display: block;
    }
  }
  
  @media (max-width: 768px) {
    .categories-menu {
      gap: 1rem;
    }
    
    .products-grid {
      grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
      gap: 1rem;
    }
  }
  /* Notificación pequeña */
#notification {
  position: fixed;
  top: 1rem;
  right: 1rem;
  background: #f100c9;
  color: white;
  padding: 0.7rem 1.2rem;
  border-radius: 5px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.2);
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.4s ease;
  font-weight: bold;
  z-index: 3000;
}
#notification.show {
  opacity: 1;
  pointer-events: auto;
}

/* css de la barra de busqueda*/
.search-container {
  position: relative;
  width: 700px;
  margin: 1rem auto;
  z-index: 9999;
}

#searchInput {
  width: 100%;
  padding: 8px 12px;
  font-size: 16px;
  border-radius: 6px;
  border: 1px solid #e98a8a;
}

.search-results {
  position: absolute;
  top: 100%;
  left: 0;
  width: 100%;
  background: rgb(255, 245, 245);
  border: 1px solid #ccc;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
  z-index: 9999;
  max-height: 400px;
  overflow-y: auto;
  padding: 10px;
}

.search-results div {
  padding: 10px;
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 12px;
  transition: background 0.2s ease;
  border-bottom: 1px solid #f10b0b;
}

.search-results div:hover {
  background-color: #e6ac0e;
}

.search-results img {
  width: 60px;
  height: 60px;
  object-fit: cover;
  border-radius: 5px;
}

.stock-info {
  font-size: 0.9rem;
  color: #9c2c2c;
  margin-top: 4px;
}



</style>
</head>
<body>
<div id="notification">Producto agregado</div>

<!-- Header -->
<header>
  <div class="logo-title">
    <img src="urban logo.png" alt="URBAN TECH" class="logo">
    <h1 class="site-title">URBAN TECH</h1>
  </div>
  
  <div class="header-right">
    <button class="cart-btn" id="openCart">
      🛒 Carrito
      <span class="cart-count" id="cartCount">0</span>
    </button>
  </div>
</header>

<!-- Navigation - Categorías alineadas a la derecha -->
<nav>
  <ul class="categories-menu" id="categoriesMenu"></ul>
</nav>
<!-- ✅ Barra de búsqueda (ubicada justo después del nav) -->
<div class="search-container">
  <input type="text" id="searchInput" placeholder="Buscar producto...">
  <div id="searchResults" class="search-results"></div>
</div>

<!-- Main Content -->
<div class="main-container">
  <!-- Sidebar with Banners -->
  <aside class="sidebar" id="sidebarBanners"></aside>
  
  <!-- Product Grid -->
  <main class="content">
    <div class="products-grid" id="productsGrid"></div>
  </main>
</div>

<!-- Shopping Cart Overlay -->
<div class="cart-overlay" id="cartOverlay">
  <div class="cart-container">
    <div class="cart-header">
      <h2>Tu Carrito</h2>
      <button class="close-cart" id="closeCart">&times;</button>
    </div>
    
    <div class="cart-items" id="cartItems"></div>
    
    <div class="cart-summary">
      <div class="cart-total">
        <span>Total:</span>
        <span id="cartTotal">Q0.00</span>
      </div>
      
      <div class="cart-buttons">
        <button class="checkout-btn" id="checkoutBtn">Finalizar Compra</button>
        <button class="clear-cart-btn" id="clearCartBtn">Vaciar Carrito</button>
      </div>
    </div>
  </div>
</div>

<!-- Modal de datos de envío -->
<div class="modal" id="checkoutModal">
  <div class="modal-content">
    <div class="modal-header">
      <h2>Información de Envío</h2>
      <button class="close-modal" id="closeModal">&times;</button>
    </div>
    <form id="deliveryForm">
      <div class="form-group">
        <label for="name">Nombre completo</label>
        <input type="text" id="name" required>
      </div>
      <div class="form-group">
        <label for="phone">Teléfono</label>
        <input type="tel" id="phone" required>
      </div>
      <div class="form-group">
        <label for="address">Dirección</label>
        <input type="text" id="address" required>
      </div>
      <div class="form-group">
        <label for="nit">NIT (opcional)</label>
        <input type="text" id="nit">
      </div>
      <div class="form-group">
        <label for="notes">Notas adicionales</label>
        <input type="text" id="notes">
      </div>
      <button type="submit" class="submit-btn">Confirmar y enviar pedido</button>
    </form>
  </div>
</div>



<!-- Promotions Bar -->
<footer class="promotions-bar">
  <div class="promotions-content" id="promotionsContent"></div>
</footer>

<script>
  const notification = document.getElementById('notification');

function showNotification(message = "Producto agregado") {
  notification.textContent = message;
  notification.classList.add('show');
  
  setTimeout(() => {
    notification.classList.remove('show');
  }, 2000); // dura 2 segundos
}

// DOM Elements
const categoriesMenu = document.getElementById('categoriesMenu');
const sidebarBanners = document.getElementById('sidebarBanners');
const productsGrid = document.getElementById('productsGrid');
const cartCount = document.getElementById('cartCount');
const openCart = document.getElementById('openCart');
const cartOverlay = document.getElementById('cartOverlay');
const closeCart = document.getElementById('closeCart');
const cartItems = document.getElementById('cartItems');
const cartTotal = document.getElementById('cartTotal');
const checkoutBtn = document.getElementById('checkoutBtn');
const clearCartBtn = document.getElementById('clearCartBtn');
const promotionsContent = document.getElementById('promotionsContent');
const checkoutModal = document.getElementById('checkoutModal');
const closeModal = document.getElementById('closeModal');
const deliveryForm = document.getElementById('deliveryForm');

// Data
let products = JSON.parse(localStorage.getItem('productos')) || [];
let categories = JSON.parse(localStorage.getItem('categorias')) || [];
let subcategories = JSON.parse(localStorage.getItem('subcategorias')) || {};
let banners = JSON.parse(localStorage.getItem('banners')) || [];
let promotions = JSON.parse(localStorage.getItem('promociones')) || [];
let cart = JSON.parse(localStorage.getItem('cart')) || [];

// Cargo fijo de envío
const envio = 35;
function setupCheckout() {
  // Abrir carrito al hacer clic en el botón carrito
  openCart.addEventListener('click', () => {
    if(cart.length === 0) {
      alert('Tu carrito está vacío.');
      return;
    }
    cartOverlay.style.display = 'flex';
  });

  // Cerrar carrito al hacer clic en la X
  closeCart.addEventListener('click', () => {
    cartOverlay.style.display = 'none';
  });

  // Cerrar carrito al hacer clic fuera del contenedor
  window.addEventListener('click', (e) => {
    if (e.target === cartOverlay) {
      cartOverlay.style.display = 'none';
    }
  });

  // Abrir modal de checkout al hacer clic en "Finalizar compra"
  checkoutBtn.addEventListener('click', () => {
    if(cart.length === 0) {
      alert('Tu carrito está vacío.');
      return;
    }
    cartOverlay.style.display = 'none'; // ocultar carrito
    checkoutModal.style.display = 'flex'; // mostrar modal
  });

  // Cerrar modal al hacer clic en la X del modal
  closeModal.addEventListener('click', () => {
    checkoutModal.style.display = 'none';
  });

  // Cerrar modal al hacer clic fuera del contenido del modal
  window.addEventListener('click', (e) => {
    if (e.target === checkoutModal) {
      checkoutModal.style.display = 'none';
    }
  });
}


function init() {
  renderCategories();
  renderBanners();
  renderProducts();
  renderPromotions();
  updateCartCount();
  setupCheckout();
const adminWhatsAppNumber = '50256985219'; // numero de whatsaap

// Listener para envío del formulario de checkout
deliveryForm.addEventListener('submit', e => {
  e.preventDefault();

  const cliente = document.getElementById('name').value.trim();
  const telefono = document.getElementById('phone').value.trim();
  const direccion = document.getElementById('address').value.trim();
  const nit = document.getElementById('nit').value.trim();
  const notas = document.getElementById('notes').value.trim();

  if (!cliente || !telefono || !direccion) {
    alert('Por favor complete todos los campos obligatorios.');
    return;
  }

  if (cart.length === 0) {
    alert('El carrito está vacío.');
    return;
  }

  const pedido = {
    id: Date.now(),
    cliente,
    telefono,
    direccion,
    nit,
    notas,
    productos: cart.map(item => ({
      nombre: item.name,
      cantidad: item.quantity,
      precio: item.price
    })),
    estado: 'Pendiente',
    fecha: new Date().toLocaleString()
  };

  let pedidos = JSON.parse(localStorage.getItem('pedidos')) || [];
  pedidos.push(pedido);
  localStorage.setItem('pedidos', JSON.stringify(pedidos));

  // Armar mensaje para WhatsApp
  let mensaje = `*Nuevo Pedido URBAN TECH*\n\n`;
  mensaje += `Cliente: ${cliente}\n`;
  mensaje += `Teléfono: ${telefono}\n`;
  mensaje += `Dirección: ${direccion}\n`;
  if (nit) mensaje += `NIT: ${nit}\n`;
  if (notas) mensaje += `Notas: ${notas}\n`;
  mensaje += `Fecha: ${pedido.fecha}\n\n`;
  mensaje += `Productos:\n`;

  pedido.productos.forEach(p => {
    mensaje += `- ${p.nombre} x${p.cantidad} (Q${p.precio.toFixed(2)})\n`;
  });

  const subtotal = pedido.productos.reduce((acc, p) => acc + p.precio * p.cantidad, 0);
  const envio = 35;
  const total = subtotal + envio;

  mensaje += `\nSubtotal: Q${subtotal.toFixed(2)}`;
  mensaje += `\nEnvío: Q${envio.toFixed(2)}`;
  mensaje += `\n*Total: Q${total.toFixed(2)}*`;

  // Codificar mensaje para URL
  const mensajeCodificado = encodeURIComponent(mensaje);

  // Abrir WhatsApp en nueva ventana o pestaña
  window.open(`https://wa.me/${adminWhatsAppNumber}?text=${mensajeCodificado}`, '_blank');

  alert('Pedido enviado correctamente.');

  cart = [];
  updateCart();

  deliveryForm.reset();
  checkoutModal.style.display = 'none';
});

init();

  // Check for new data every 5 seconds
  setInterval(checkForUpdates, 5000);
}


// Check for updates in localStorage
function checkForUpdates() {
  const newProducts = JSON.parse(localStorage.getItem('productos')) || [];
  const newCategories = JSON.parse(localStorage.getItem('categorias')) || [];
  const newSubcategories = JSON.parse(localStorage.getItem('subcategorias')) || {};
  const newBanners = JSON.parse(localStorage.getItem('banners')) || [];
  const newPromotions = JSON.parse(localStorage.getItem('promociones')) || [];
  
  if (JSON.stringify(newProducts) !== JSON.stringify(products)) {
    products = newProducts;
    renderProducts();
  }
  
  if (JSON.stringify(newCategories) !== JSON.stringify(categories) || 
      JSON.stringify(newSubcategories) !== JSON.stringify(subcategories)) {
    categories = newCategories;
    subcategories = newSubcategories;
    renderCategories();
  }
  
  if (JSON.stringify(newBanners) !== JSON.stringify(banners)) {
    banners = newBanners;
    renderBanners();
  }
  
  if (JSON.stringify(newPromotions) !== JSON.stringify(promotions)) {
    promotions = newPromotions;
    renderPromotions();
  }
}

// Render categories and subcategories menu
function renderCategories() {
  categoriesMenu.innerHTML = '';
  
  categories.forEach(category => {
    const li = document.createElement('li');
    
    const a = document.createElement('a');
    a.href = '#';
    a.textContent = category;
    a.addEventListener('click', (e) => {
      e.preventDefault();
      filterProductsByCategory(category);
    });
    
    li.appendChild(a);
    
    // Add subcategories if they exist
    if (subcategories[category] && subcategories[category].length > 0) {
      const ul = document.createElement('ul');
      ul.className = 'subcategories';
      
      subcategories[category].forEach(subcategory => {
        const subLi = document.createElement('li');
        
        const subA = document.createElement('a');
        subA.href = '#';
        subA.textContent = subcategory;
        subA.addEventListener('click', (e) => {
          e.preventDefault();
          filterProductsBySubcategory(category, subcategory);
        });
        
        subLi.appendChild(subA);
        ul.appendChild(subLi);
      });
      
      li.appendChild(ul);
    }
    
    categoriesMenu.appendChild(li);
  });
}

// Filter products by category
function filterProductsByCategory(category) {
  const filteredProducts = products.filter(product => product.categoria === category);
  renderProducts(filteredProducts);
}

// Filter products by subcategory
function filterProductsBySubcategory(category, subcategory) {
  const filteredProducts = products.filter(product => 
    product.categoria === category && product.subcategoria === subcategory
  );
  renderProducts(filteredProducts);
}

// Render banners in sidebar
function renderBanners() {
  sidebarBanners.innerHTML = '';
  
  if (banners.length === 0) {
    sidebarBanners.innerHTML = '<p>No hay banners disponibles</p>';
    return;
  }
  
  banners.forEach(banner => {
    const bannerDiv = document.createElement('div');
    bannerDiv.className = 'banner';
    
    if (banner.animado) {
      bannerDiv.classList.add('floating-banner');
    }
    
    const img = document.createElement('img');
    img.src = banner.base64;
    img.alt = 'Banner promocional';
    
    bannerDiv.appendChild(img);
    sidebarBanners.appendChild(bannerDiv);
  });
}

// Render products grid
function renderProducts(productsToShow = products) {
  productsGrid.innerHTML = '';
  
  if (productsToShow.length === 0) {
    productsGrid.innerHTML = '<p>No hay productos disponibles</p>';
    return;
  }
  
  productsToShow.forEach(product => {
    const productCard = document.createElement('div');
    productCard.className = 'product-card';

    // Product image
    const productImage = document.createElement('div');
    productImage.className = 'product-image';
    
    const img = document.createElement('img');
    img.src = product.imagenBase64 || 'https://via.placeholder.com/200';
    img.alt = product.nombre;
    
    productImage.appendChild(img);
    productCard.appendChild(productImage);
    
    // Product info
    const productInfo = document.createElement('div');
    productInfo.className = 'product-info';
    
    const title = document.createElement('h3');
    title.className = 'product-title';
    title.textContent = product.nombre;
    productInfo.appendChild(title);
    
    // Price
  // Price
const priceDiv = document.createElement('div');
priceDiv.className = 'product-price';

const hasDiscount = product.descuento && product.descuento > 0;
const finalPrice = hasDiscount ? (product.precio - product.descuento) : product.precio;

const currentPrice = document.createElement('span');
currentPrice.className = 'current-price';
currentPrice.textContent = `Q${finalPrice.toFixed(2)}`;
priceDiv.appendChild(currentPrice);

if (hasDiscount) {
  const originalPrice = document.createElement('span');
  originalPrice.className = 'original-price';
  originalPrice.textContent = `Q${product.precio.toFixed(2)}`;
  priceDiv.appendChild(originalPrice);

  const discountBadge = document.createElement('span');
  discountBadge.className = 'discount-badge';
  discountBadge.textContent = `${Math.round((product.descuento / product.precio) * 100)}% OFF`;
  priceDiv.appendChild(discountBadge);
}

productInfo.appendChild(priceDiv);

// Stock disponible
const stockInfo = document.createElement('div');
stockInfo.className = 'stock-info';
stockInfo.textContent = `Disponible: ${product.stock} unidad${product.stock !== 1 ? 'es' : ''}`;
productInfo.appendChild(stockInfo);

    
    if (hasDiscount) {
      const originalPrice = document.createElement('span');
      originalPrice.className = 'original-price';
      originalPrice.textContent = `Q${product.precio.toFixed(2)}`;
      priceDiv.appendChild(originalPrice);
      
      const discountBadge = document.createElement('span');
      discountBadge.className = 'discount-badge';
      discountBadge.textContent = `${Math.round((product.descuento / product.precio) * 100)}% OFF`;
      priceDiv.appendChild(discountBadge);
    }
    
    productInfo.appendChild(priceDiv);
    
    // Add to cart button
    const addToCartBtn = document.createElement('button');
    addToCartBtn.className = 'add-to-cart';
    
    // Verificar stock antes de asignar texto y evento
    if (!product.stock || product.stock <= 0) {
      addToCartBtn.textContent = 'Agotado';
      addToCartBtn.disabled = true;
      addToCartBtn.style.background = '#ccc';
      addToCartBtn.style.cursor = 'not-allowed';
    } else {
      addToCartBtn.textContent = 'Añadir al carrito';
      addToCartBtn.addEventListener('click', () => addToCart(product));
    }
    
    productInfo.appendChild(addToCartBtn);
    productCard.appendChild(productInfo);
    
    productsGrid.appendChild(productCard);
  });
}


// Render promotions marquee
function renderPromotions() {
  promotionsContent.innerHTML = '';
  
  if (promotions.length === 0) {
    promotionsContent.textContent = 'No hay promociones disponibles • ';
    return;
  }
  
  promotions.forEach(promo => {
    const promoSpan = document.createElement('span');
    promoSpan.textContent = promo.texto + ' • ';
    promoSpan.style.color = promo.color;
    
    if (promo.animado) {
      promoSpan.style.animation = 'pulse 1s infinite alternate';
    }
    
    if (promo.base64) {
      const img = document.createElement('img');
      img.src = promo.base64;
      img.style.height = '20px';
      img.style.verticalAlign = 'middle';
      img.style.margin = '0 10px';
      promoSpan.appendChild(img);
    }
    
    promotionsContent.appendChild(promoSpan);
  });
}

function addToCart(product) {
  const existingItem = cart.find(item => item.id === product.nombre);
  
  // Validar stock antes de agregar más unidades
  if (existingItem) {
    if (existingItem.quantity >= existingItem.stock) {
      alert(`No hay más unidades disponibles de ${product.nombre}`);
      return; // No agrega más
    }
    existingItem.quantity++;
  } else {
    if (product.stock <= 0) {
      alert(`Producto ${product.nombre} está agotado`);
      return;
    }
    cart.push({
      id: product.nombre,
      name: product.nombre,
      price: product.descuento && product.descuento > 0
        ? (product.precio - product.descuento)
        : product.precio,
      quantity: 1,
      image: product.imagenBase64,
      stock: product.stock  // ✅ Agregado aquí
    });
  }

  updateCart();
  // showCart(); // Puedes mantenerlo desactivado si no deseas abrir el carrito
}

  

function updateCart() {
  localStorage.setItem('cart', JSON.stringify(cart));
  updateCartCount();
  renderCartItems();
}

function updateCartCount() {
  const totalItems = cart.reduce((total, item) => total + item.quantity, 0);
  cartCount.textContent = totalItems;
}

function renderCartItems() {
  cartItems.innerHTML = '';

  if (cart.length === 0) {
    cartItems.innerHTML = '<p>Tu carrito está vacío</p>';
    cartTotal.textContent = 'Q0.00';
    return;
  }

  let subtotal = 0;

  cart.forEach(item => {
    const cartItem = document.createElement('div');
    cartItem.className = 'cart-item';

    // Imagen
    const itemImage = document.createElement('div');
    itemImage.className = 'cart-item-image';

    const img = document.createElement('img');
    img.src = item.image || 'https://via.placeholder.com/80';
    img.alt = item.name;

    itemImage.appendChild(img);
    cartItem.appendChild(itemImage);

    // Detalles
    const itemDetails = document.createElement('div');
    itemDetails.className = 'cart-item-details';

    const title = document.createElement('div');
    title.className = 'cart-item-title';
    title.textContent = item.name;
    itemDetails.appendChild(title);

    // Mostrar stock disponible
    const stockInfo = document.createElement('div');
    stockInfo.className = 'cart-item-stock';
    stockInfo.textContent = `Disponible: ${item.stock ?? '—'} unidades`;
    stockInfo.style.fontSize = '0.85rem';
    stockInfo.style.color = '#777';
    itemDetails.appendChild(stockInfo);

    const price = document.createElement('div');
    price.className = 'cart-item-price';
    price.textContent = `Q${item.price.toFixed(2)} c/u`;
    itemDetails.appendChild(price);

    // Acciones
    const actions = document.createElement('div');
    actions.className = 'cart-item-actions';

    const decreaseBtn = document.createElement('button');
    decreaseBtn.className = 'quantity-btn';
    decreaseBtn.textContent = '-';
    decreaseBtn.addEventListener('click', () => updateQuantity(item.id, -1));
    actions.appendChild(decreaseBtn);

    const quantity = document.createElement('span');
    quantity.textContent = item.quantity;
    actions.appendChild(quantity);

    const increaseBtn = document.createElement('button');
    increaseBtn.className = 'quantity-btn';
    increaseBtn.textContent = '+';

    // Desactivar botón "+" si ya llegó al stock
    if (item.stock && item.quantity >= item.stock) {
      increaseBtn.disabled = true;
      increaseBtn.style.opacity = 0.5;
      increaseBtn.style.cursor = 'not-allowed';
    } else {
      increaseBtn.addEventListener('click', () => updateQuantity(item.id, 1));
    }

    actions.appendChild(increaseBtn);

    const removeBtn = document.createElement('button');
    removeBtn.className = 'remove-item';
    removeBtn.textContent = 'Eliminar';
    removeBtn.addEventListener('click', () => removeItem(item.id));
    actions.appendChild(removeBtn);

    itemDetails.appendChild(actions);
    cartItem.appendChild(itemDetails);
    cartItems.appendChild(cartItem);

    subtotal += item.price * item.quantity;
  });

  const envio = 35;
  const total = subtotal + envio;

  cartTotal.innerHTML = `
    Subtotal: Q${subtotal.toFixed(2)}<br>
    Envío: Q${envio.toFixed(2)}<br>
    <strong>Total: Q${total.toFixed(2)}</strong>
  `;
}


function updateQuantity(id, change) {
  const item = cart.find(item => item.id === id);
  const productData = products.find(p => p.nombre === id); // Obtener el producto original para verificar stock

  if (item && productData) {
    if (change > 0 && item.quantity >= productData.stock) {
      alert(`No hay más unidades disponibles de ${item.name}`);
      return;
    }

    item.quantity += change;

    if (item.quantity <= 0) {
      cart = cart.filter(item => item.id !== id);
    }

    updateCart();
  }
}

function removeItem(id) {
  cart = cart.filter(item => item.id !== id);
  updateCart();
}

function clearCart() {
  if (confirm('¿Estás seguro de que quieres vaciar el carrito?')) {
    cart = [];
    updateCart();
  }
}

function showCart() {
  cartOverlay.style.display = 'flex';
}

function hideCart() {
  cartOverlay.style.display = 'none';
}

// Event Listeners
document.addEventListener('DOMContentLoaded', () => {
  renderCategories();
  renderBanners();
  renderPromotions();
  renderProducts();
  updateCart();
});
document.addEventListener('DOMContentLoaded', () => {
  renderCategories();
  renderBanners();
  renderPromotions();
  renderProducts();
  updateCart();

  // Barra de búsqueda
  const searchInput = document.getElementById('searchInput');
  const searchResults = document.getElementById('searchResults');

  searchInput.addEventListener('input', () => {
    const query = searchInput.value.trim().toLowerCase();
    searchResults.innerHTML = '';

    if (query === '') {
      searchResults.style.display = 'none';
      return;
    }

    const filtered = products.filter(p =>
      p.nombre.toLowerCase().includes(query)
    );

    if (filtered.length === 0) {
      searchResults.innerHTML = '<div>No se encontraron resultados</div>';
    } else {
      filtered.forEach(product => {
        const div = document.createElement('div');
        div.innerHTML = `<img src="${product.imagenBase64}" alt="${product.nombre}"><span>${product.nombre}</span>`;
        div.addEventListener('click', () => {
          renderProducts([product]);
          searchResults.style.display = 'none';
          searchInput.value = '';
        });
        searchResults.appendChild(div);
      });
    }

    searchResults.style.display = 'block';
  });

  document.addEventListener('click', (e) => {
    if (!searchResults.contains(e.target) && e.target !== searchInput) {
      searchResults.style.display = 'none';
    }
  });
});

openCart.addEventListener('click', showCart);
closeCart.addEventListener('click', hideCart);
clearCartBtn.addEventListener('click', clearCart);

// Agregar producto al carrito con delegación de eventos
productsGrid.addEventListener('click', e => {
  if(e.target.classList.contains('add-to-cart')) {
    const productId = e.target.getAttribute('data-product-id');
    const product = products.find(p => p.nombre === productId);
    if(product) {
      addToCart(product);
    }
  }
});

// Checkout Modal
checkoutBtn.addEventListener('click', () => {
  if(cart.length === 0) {
    alert('Tu carrito está vacío.');
    return;
  }
  hideCart();
  checkoutModal.style.display = 'flex';
});

closeModal.addEventListener('click', () => {
  checkoutModal.style.display = 'none';
});

window.addEventListener('click', e => {
  if(e.target === checkoutModal) {
    checkoutModal.style.display = 'none';
  }
});

// Submit datos de envío
deliveryForm.addEventListener('submit', e => {
  e.preventDefault();
  
  // Aquí puedes capturar los datos y enviarlos por WhatsApp o guardarlos
  const name = document.getElementById('name').value.trim();
  const phone = document.getElementById('phone').value.trim();
  const address = document.getElementById('address').value.trim();
  const nit = document.getElementById('nit').value.trim();
  const notes = document.getElementById('notes').value.trim();
  
  // Aquí construir mensaje pedido (simplificado)
  let message = `Nuevo pedido de ${name}%0ATeléfono: ${phone}%0ADirección: ${address}%0A`;
  if(nit) message += `NIT: ${nit}%0A`;
  if(notes) message += `Notas: ${notes}%0A`;
  message += `Productos:%0A`;
  cart.forEach(item => {
    message += `${item.name} x${item.quantity} - Q${(item.price * item.quantity).toFixed(2)}%0A`;
  });
  message += `Envío: Q35.00%0A`;
  const subtotal = cart.reduce((sum, item) => sum + item.price * item.quantity, 0);
  const total = subtotal + 35;
  message += `Total: Q${total.toFixed(2)}%0A`;
  
  // Abrir WhatsApp (reemplaza el número por el tuyo)
  const whatsappNumber = '50212345678'; 
  window.open(`https://wa.me/${whatsappNumber}?text=${message}`, '_blank');
  
  // Limpiar carrito y cerrar modal
  cart = [];
  updateCart();
  checkoutModal.style.display = 'none';
  alert('Pedido enviado por WhatsApp con éxito');
});
</script>
</body>
</html>